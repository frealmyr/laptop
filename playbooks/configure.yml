---
- hosts: localhost
  become: true

  tasks:
    ###########
    ## Shell ##
    ###########

    - name: set zsh as default shell
      shell: chsh -s $(which zsh) fredrick

    ###########
    ## Gnome ##
    ###########

    - name: dconf - gnome window manager
      community.general.dconf:
        key: "{{ item.path }}"
        value: "{{ item.value }}"
        state: present
      with_items:
        - path: /org/gnome/shell/overrides/dynamic-workspaces
          value: 0 # False
        - path: /org/gnome/shell/overrides/workspaces-only-on-primary
          value: 1 # True
        - path: /org/gnome/desktop/wm/preferences/num-workspaces
          value: "6"
        - path: /org/gnome/mutter/center-new-windows
          value: 0 # False
        - path: /org/gnome/mutter/edge-tiling
          value: 0 # False

    - name: dconf - popos shell
      community.general.dconf:
        key: "{{ item.path }}"
        value: "{{ item.value }}"
        state: present
      with_items:
        - path: /org/gnome/shell/extensions/pop-shell/active-hint
          value: 1 # True
        - path: /org/gnome/shell/extensions/pop-shell/hint-color-rgba
          value: "['rgb(254,91,255)']"
        - path: /org/gnome/shell/extensions/pop-shell/tile-by-default
          value: 1 # True
        - path: /org/gnome/shell/extensions/pop-shell/gap-inner
          value: "2"
        - path: /org/gnome/shell/extensions/pop-shell/gap-outer
          value: "2"

    # ########
    # ## UI ##
    # ########

    - name: dconf - disable all animations
      community.general.dconf:
        key: "/org/gnome/desktop/interface/enable-animations"
        value: "false"
        state: present
      become_user: fredrick

    - name: theme - download dracula gnome gtk theme
      ansible.builtin.git:
        repo: "https://github.com/dracula/gtk.git"
        dest: /usr/share/themes/dracula
        version: "42"

    - name: dconf - use dracula as gnome gtk theme
      community.general.dconf:
        key: "/org/gnome/desktop/interface/gtk-theme"
        value: "'dracula'"
        state: present
      become_user: fredrick

    - name: flatpak - allow themes folder in home
      command: sudo flatpak override --filesystem=$HOME/.themes
      become_user: fredrick

    - name: flatpak - set dracula as default theme
      command: sudo flatpak override --env=GTK_THEME=Dracula
      become_user: fredrick

    # ############
    # ## Docker ##
    # ############

    - name: docker - add user to docker group
      user: name=fredrick
        groups=docker
        append=yes

    - name: docker - check if docker config.json exists
      stat:
        path: ~/.docker/config.json
      become_user: fredrick
      register: dockerfile_exist_result

    - name: docker - use gnome keychain for credsStore
      ansible.builtin.lineinfile:
        path: ~/.docker/config.json
        line: |
          { 
            "credsStore": "secretservice" 
          }
        create: yes
      become_user: fredrick
      when: not dockerfile_exist_result.stat.exists

    - name: docker - disable system services (for power savings)
      ansible.builtin.systemd:
        name: "{{ item }}"
        enabled: no
        masked: no
      become_user: root
      with_items:
        - docker.socket
        - docker.service
        - containerd.service

    # ##############
    # ## Firewall ##
    # ##############

    - name: firewall - enable ufw
      community.general.ufw:
        state: enabled
        policy: deny
